import{a as B}from"./axios-CCb-kr4I.js";import{u as G}from"./wishlist-mDxJnupN.js";import{q as N,r as n,w as y,d as U,e as A,m as j,_ as P,o as c,c as v,a as m,F as I,f as S,p as z,t as Y,b as O,y as H,z as J}from"./index-BNjNS9Do.js";const Q=N({name:"MovieGrid",props:{genreCode:{type:String,required:!0},apiKey:{type:String,required:!0},sortingOrder:{type:String,required:!0,default:"all"},voteEverage:{type:Number,required:!0,default:100}},setup(e){const l=n([]),h=n(1),u=n(null),g=n(null),p=n(4),i=n(!1),f=n(window.innerWidth<=768),a=n("grid"),d=n(!0),M=n(!1);let w=null;y(()=>e.genreCode,()=>{T()}),y(()=>e.sortingOrder,()=>{T()}),y(()=>e.voteEverage,()=>{T()});const{loadWishlist:$,toggleWishlist:C,isInWishlist:q}=G(),_=async()=>{if(i.value||!d.value)return;i.value=!0;let t=null;try{e.genreCode==="0"?t=await B.get("https://api.themoviedb.org/3/movie/popular",{params:{api_key:e.apiKey,language:"ko-KR",page:h.value,per_page:10}}):t=await B.get("https://api.themoviedb.org/3/discover/movie",{params:{api_key:e.apiKey,with_genres:e.genreCode,language:"ko-KR",page:h.value,per_page:10}});const o=t.data.results;if(o.length>0){let s=[...l.value,...o];e.sortingOrder!=="all"&&(s=s.filter(r=>r.original_language===e.sortingOrder)),s=s.filter(r=>{let b=!1;return e.voteEverage===-1?b=!0:e.voteEverage===-2?b=r.vote_average<=4:b=r.vote_average>=e.voteEverage&&r.vote_average<e.voteEverage+1,b}),l.value=s,h.value++}else d.value=!1}catch(o){console.error("Error fetching movies:",o)}finally{i.value=!1}},K=t=>t?`https://image.tmdb.org/t/p/w300${t}`:"/placeholder-image.jpg",E=()=>{if(u.value){const t=u.value.offsetWidth,o=f.value?100:300,s=f.value?10:15;p.value=Math.floor(t/(o+s))}},V=U(()=>l.value.reduce((t,o,s)=>{const r=Math.floor(s/p.value);return t[r]||(t[r]=[]),t[r].push(o),t},[])),W=()=>{f.value=window.innerWidth<=768,E()},k=()=>{if(!u.value)return;const t=u.value.lastElementChild;if(!t)return;const o=u.value.getBoundingClientRect().bottom,s=t.getBoundingClientRect().bottom;o>=s-100&&!i.value&&d.value&&_()},L=()=>{const t=window.pageYOffset||document.documentElement.scrollTop;M.value=t>300,k()},T=()=>{l.value=[],h.value=1,d.value=!0,_()},D=()=>{window.scrollTo({top:0,behavior:"smooth"}),T()},F=t=>{R(),w=window.setTimeout(()=>{C(t)},800)},R=()=>{w!==null&&(clearTimeout(w),w=null)};return A(()=>{_().then(()=>{k()}),E(),$(),window.addEventListener("resize",W),window.addEventListener("scroll",L);const t=new IntersectionObserver(o=>{o[0].isIntersecting&&!i.value&&d.value&&_()},{rootMargin:"100px",threshold:.1});g.value&&t.observe(g.value),j(()=>{window.removeEventListener("resize",W),window.removeEventListener("scroll",L),g.value&&t.unobserve(g.value)})}),{visibleMovieGroups:V,getImageUrl:K,gridContainer:u,loadingTrigger:g,rowSize:p,isLoading:i,currentView:a,hasMore:d,showTopButton:M,scrollToTopAndReset:D,startWishlistTimer:F,clearWishlistTimer:R,toggleWishlist:C,isInWishlist:q}}}),X={class:"movie-grid",ref:"gridContainer"},Z=["onMouseup"],x=["src","alt"],ee={class:"movie-title"},te={key:0,class:"wishlist-indicator"},oe={ref:"loadingTrigger",class:"loading-trigger"},ie={key:0,class:"loading-indicator"};function se(e,l,h,u,g,p){return c(),v("div",X,[m("div",{class:z(["grid-container",e.currentView])},[(c(!0),v(I,null,S(e.visibleMovieGroups,(i,f)=>(c(),v("div",{key:f,class:z(["movie-row",{full:i.length===e.rowSize}])},[(c(!0),v(I,null,S(i,a=>(c(),v("div",{key:a.id,class:"movie-card",onMouseup:d=>e.toggleWishlist(a)},[m("img",{src:e.getImageUrl(a.poster_path),alt:a.title},null,8,x),m("div",ee,Y(a.title),1),e.isInWishlist(a.id)?(c(),v("div",te,"👍")):O("",!0)],40,Z))),128))],2))),128))],2),m("div",oe,[e.isLoading?(c(),v("div",ie,"Loading...")):O("",!0)],512),H(m("button",{onClick:l[0]||(l[0]=(...i)=>e.scrollToTopAndReset&&e.scrollToTopAndReset(...i)),class:"top-button"},"Top",512),[[J,e.showTopButton]])],512)}const le=P(Q,[["render",se],["__scopeId","data-v-ed94f36e"]]);export{le as M};
