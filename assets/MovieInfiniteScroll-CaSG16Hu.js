import{_ as N,s as U,r as n,w as M,d as D,e as F,p as j,o as c,c as v,a as m,F as B,f as I,q as S,t as P,b as z,z as Y,A as H,g as O}from"./index-Cahi4Koy.js";import{u as J}from"./wishlist-N3ncP2iu.js";const Q=U({name:"MovieGrid",props:{genreCode:{type:String,required:!0},apiKey:{type:String,required:!0},sortingOrder:{type:String,required:!0,default:"all"},voteEverage:{type:Number,required:!0,default:100}},setup(e){const l=n([]),h=n(1),u=n(null),g=n(null),p=n(4),s=n(!1),f=n(window.innerWidth<=768),a=n("grid"),d=n(!0),y=n(!1);let w=null;M(()=>e.genreCode,()=>{T()}),M(()=>e.sortingOrder,()=>{T()}),M(()=>e.voteEverage,()=>{T()});const{loadWishlist:$,toggleWishlist:C,isInWishlist:q}=J(),_=async()=>{if(s.value||!d.value)return;s.value=!0;let t=null;try{e.genreCode==="0"?t=await O.get("https://api.themoviedb.org/3/movie/popular",{params:{api_key:e.apiKey,language:"ko-KR",page:h.value,per_page:10}}):t=await O.get("https://api.themoviedb.org/3/discover/movie",{params:{api_key:e.apiKey,with_genres:e.genreCode,language:"ko-KR",page:h.value,per_page:10}});const o=t.data.results;if(o.length>0){let i=[...l.value,...o];e.sortingOrder!=="all"&&(i=i.filter(r=>r.original_language===e.sortingOrder)),i=i.filter(r=>{let b=!1;return e.voteEverage===-1?b=!0:e.voteEverage===-2?b=r.vote_average<=4:b=r.vote_average>=e.voteEverage&&r.vote_average<e.voteEverage+1,b}),l.value=i,h.value++}else d.value=!1}catch(o){console.error("Error fetching movies:",o)}finally{s.value=!1}},K=t=>t?`https://image.tmdb.org/t/p/w300${t}`:"/placeholder-image.jpg",E=()=>{if(u.value){const t=u.value.offsetWidth,o=f.value?100:300,i=f.value?10:15;p.value=Math.floor(t/(o+i))}},V=D(()=>l.value.reduce((t,o,i)=>{const r=Math.floor(i/p.value);return t[r]||(t[r]=[]),t[r].push(o),t},[])),W=()=>{f.value=window.innerWidth<=768,E()},k=()=>{if(!u.value)return;const t=u.value.lastElementChild;if(!t)return;const o=u.value.getBoundingClientRect().bottom,i=t.getBoundingClientRect().bottom;o>=i-100&&!s.value&&d.value&&_()},L=()=>{const t=window.pageYOffset||document.documentElement.scrollTop;y.value=t>300,k()},T=()=>{l.value=[],h.value=1,d.value=!0,_()},A=()=>{window.scrollTo({top:0,behavior:"smooth"}),T()},G=t=>{R(),w=window.setTimeout(()=>{C(t)},800)},R=()=>{w!==null&&(clearTimeout(w),w=null)};return F(()=>{_().then(()=>{k()}),E(),$(),window.addEventListener("resize",W),window.addEventListener("scroll",L);const t=new IntersectionObserver(o=>{o[0].isIntersecting&&!s.value&&d.value&&_()},{rootMargin:"100px",threshold:.1});g.value&&t.observe(g.value),j(()=>{window.removeEventListener("resize",W),window.removeEventListener("scroll",L),g.value&&t.unobserve(g.value)})}),{visibleMovieGroups:V,getImageUrl:K,gridContainer:u,loadingTrigger:g,rowSize:p,isLoading:s,currentView:a,hasMore:d,showTopButton:y,scrollToTopAndReset:A,startWishlistTimer:G,clearWishlistTimer:R,toggleWishlist:C,isInWishlist:q}}}),X={class:"movie-grid",ref:"gridContainer"},Z=["onMouseup"],x=["src","alt"],ee={class:"movie-title"},te={key:0,class:"wishlist-indicator"},oe={ref:"loadingTrigger",class:"loading-trigger"},se={key:0,class:"loading-indicator"};function ie(e,l,h,u,g,p){return c(),v("div",X,[m("div",{class:S(["grid-container",e.currentView])},[(c(!0),v(B,null,I(e.visibleMovieGroups,(s,f)=>(c(),v("div",{key:f,class:S(["movie-row",{full:s.length===e.rowSize}])},[(c(!0),v(B,null,I(s,a=>(c(),v("div",{key:a.id,class:"movie-card",onMouseup:d=>e.toggleWishlist(a)},[m("img",{src:e.getImageUrl(a.poster_path),alt:a.title},null,8,x),m("div",ee,P(a.title),1),e.isInWishlist(a.id)?(c(),v("div",te,"👍")):z("",!0)],40,Z))),128))],2))),128))],2),m("div",oe,[e.isLoading?(c(),v("div",se,"Loading...")):z("",!0)],512),Y(m("button",{onClick:l[0]||(l[0]=(...s)=>e.scrollToTopAndReset&&e.scrollToTopAndReset(...s)),class:"top-button"},"Top",512),[[H,e.showTopButton]])],512)}const ae=N(Q,[["render",ie],["__scopeId","data-v-fc4856b5"]]);export{ae as M};
